@startuml
!pragma teoz true
title Robustness - UC2: Verify OTP
hide footbox

skinparam shadowing false
skinparam roundcorner 12
skinparam dpi 200
skinparam maxMessageSize 30
skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true
skinparam ParticipantPadding 18

actor "Registered User" as User

box "NGO Management System"
boundary "OTP Verification\nUI" as UI
control "Security\nManager" as SecMgr
entity "User\nDatabase" as UserDB
entity "Audit\nLog" as Audit
end box

User -> UI : submitOTP(code)
UI -> SecMgr : verify(token, code)

SecMgr -> UserDB : fetchStoredOTP(userID)
UserDB --> SecMgr : return(hash)

SecMgr -> SecMgr : compareHash(input, stored)

alt Valid Code
    SecMgr -> UserDB : clearOTP()
    SecMgr -> UserDB : unlockAccount()
    SecMgr -> Audit : logAction("OTP Verified")
    SecMgr --> UI : result(success)
    UI --> User : redirect(SetNewPassword)
else Invalid Code
    SecMgr --> UI : error("Invalid Code")
    UI --> User : showErrorMessage()
end
@enduml